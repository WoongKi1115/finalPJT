<template>
  <div class="recommendpage">
    <h1>ì˜í™” ì¶”ì²œí•´ì£¼ëŠ” í˜ì´ì§€</h1>
    <h3>ì„¤ëª…ë€</h3>
    <v-row justify="center" class="mt-5">
      <v-dialog
        v-model="dialog"
        hide-overlay
        height="900px"
        width="700px"
        transition="dialog-bottom-transition"
      >
        <template v-slot:activator="{ on, attrs }">
          <v-btn
            color="#E50914"
            dark
            v-bind="attrs"
            v-on="on"
            @click="resetMoods"
          >
            ì¶”ì²œë°›ìœ¼ëŸ¬ê°€ê¸°
          </v-btn>
        </template>
        <v-card dark>
          <v-toolbar dark color="#E50914" class="mb-5">
            <v-btn icon dark @click="dialog = false">
              <v-icon>mdi-close</v-icon>
            </v-btn>
            <v-toolbar-title
              >5ê°€ì§€ ìƒíƒœë¥¼ ê³ ë¥´ê³  ì¶”ì²œë°›ê¸° ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!</v-toolbar-title
            >
            <v-spacer></v-spacer>
            <v-toolbar-items>
              <v-btn dark text @click="[save()]" class="my-font2">
                ì¶”ì²œë°›ê¸°
              </v-btn>
            </v-toolbar-items>
          </v-toolbar>
          <v-list-item color="#E50914">
            <v-row class="d-flex justify-space-around mb-4">
              <v-col>
                <v-btn
                  @click="clicked.clicked1 = !clicked.clicked1"
                  :color="clicked.clicked1 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked1 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ì‹ ë‚˜ëŠ”ğŸ˜
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked2 = !clicked.clicked2"
                  :color="clicked.clicked2 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked2 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  í™œê¸°ì°¬ğŸ˜„
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked3 = !clicked.clicked3"
                  :color="clicked.clicked3 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked3 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ì§€ë£¨í•œğŸ˜‘
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked4 = !clicked.clicked4"
                  :color="clicked.clicked4 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked4 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ìë‘ìŠ¤ëŸ¬ìš´ğŸ˜ƒ
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked5 = !clicked.clicked5"
                  :color="clicked.clicked5 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked5 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ìì‹ ê°ë„˜ì¹˜ëŠ”ğŸ¤—
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked6 = !clicked.clicked6"
                  :color="clicked.clicked6 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked6 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ë‹µë‹µí•œğŸ˜¤
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked7 = !clicked.clicked7"
                  :color="clicked.clicked7 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked7 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ìš°ìš¸í•œğŸ˜¥
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked8 = !clicked.clicked8"
                  :color="clicked.clicked8 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked8 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ì›ƒìŒì´í•„ìš”í•œğŸ˜‚
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked9 = !clicked.clicked9"
                  :color="clicked.clicked9 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked9 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ì§œì¦ë‚˜ëŠ”ğŸ˜¡
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked10 = !clicked.clicked10"
                  :color="clicked.clicked10 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked10 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  í†µì¾Œí•œğŸ˜‹
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked11 = !clicked.clicked11"
                  :color="clicked.clicked11 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked11 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ì–µìš¸í•œğŸ˜¯
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked12 = !clicked.clicked12"
                  :color="clicked.clicked12 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked12 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  í–‰ë³µí•œğŸ˜Š
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked13 = !clicked.clicked13"
                  :color="clicked.clicked13 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked13 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  í¸ì•ˆí•œğŸ˜™
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked14 = !clicked.clicked14"
                  :color="clicked.clicked14 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked14 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ì†ìƒí•œğŸ˜«
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked15 = !clicked.clicked15"
                  :color="clicked.clicked15 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked15 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ëª½í™˜ì ì¸ğŸ™ƒ
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked16 = !clicked.clicked16"
                  :color="clicked.clicked16 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked16 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  í˜„ì‹¤ì—ì„œ ë²—ì–´ë‚˜ê³ í”ˆğŸ¤ª
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked17 = !clicked.clicked17"
                  :color="clicked.clicked17 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked17 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ì§€ê¸‹ì§€ê¸‹í•œğŸ˜©
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked18 = !clicked.clicked18"
                  :color="clicked.clicked18 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked18 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ì„¤ë ˆëŠ”ğŸ˜š
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked19 = !clicked.clicked19"
                  :color="clicked.clicked19 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked19 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ì™¸ë¡œìš´ğŸ˜¶
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked20 = !clicked.clicked20"
                  :color="clicked.clicked20 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked20 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  í—ˆì „í•œğŸ˜®
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked21 = !clicked.clicked21"
                  :color="clicked.clicked21 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked21 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  ë”ìš´ğŸ¥µ
                </v-btn>
              </v-col>
              <v-col>
                <v-btn
                  @click="clicked.clicked22 = !clicked.clicked22"
                  :color="clicked.clicked22 ? '#E50914' : '#FFCDD2'"
                  :style="clicked.clicked22 ? 'color:white' : 'color:black'"
                  class="my-font"
                >
                  í¥ë¶„ë˜ëŠ”ğŸ˜²
                </v-btn>
              </v-col>
            </v-row>
          </v-list-item>
        </v-card>
      </v-dialog>
    </v-row>
    <br />
    <br />
    <v-sheet class="mx-auto" max-width="1800">
      <v-slide-group
        class="pa-4 recommendmovie"
        active-class="success"
        show-arrows
        dark
      >
        <v-slide-item v-for="(rcdMovie, index) in recommendMovie" :key="index">
          <v-card class="ma-4 pa-1" height="450" width="300">
            <div class="text-center">
              <v-dialog width="1800">
                <template v-slot:activator="{ on, attrs }">
                  <v-img
                    height="440"
                    v-bind="attrs"
                    v-on="on"
                    :src="
                      'https://image.tmdb.org/t/p/original' +
                      rcdMovie.poster_path
                    "
                  >
                  </v-img>
                </template>

                <v-card>
                  <v-card-text class="pa-7 modalstyle">
                    <v-row>
                      <v-col cols="5" class="pa-0">
                        <v-img
                          class="modalimage"
                          :src="
                            'https://image.tmdb.org/t/p/original' +
                            rcdMovie.poster_path
                          "
                        ></v-img>
                      </v-col>
                      <v-col cols="7" class="pa-0" style="color: #eeeeee">
                        <h1>{{ rcdMovie.title }}</h1>
                        <br />
                        <br />
                        <div class="d-flex justify-space-around">
                          <div>
                            <label for="genre">ì¥ë¥´ : </label>
                            <span
                              id="genre"
                              v-for="(genre, index) in rcdMovie.genre_ids"
                              :key="index"
                            >
                              {{ genre }}&nbsp;&nbsp;&nbsp;
                            </span>
                          </div>
                          <span>í‰ì  : {{ rcdMovie.vote_average }}</span>
                          <span>ê°œë´‰ì¼ : {{ rcdMovie.release_date }}</span>
                        </div>
                        <br />
                        <br />
                        <label for="overview">ì¤„ê±°ë¦¬ : </label>
                        <span id="overview">{{ rcdMovie.overview }}</span>
                      </v-col>
                    </v-row>
                  </v-card-text>
                </v-card>
              </v-dialog>
            </div>
          </v-card>
        </v-slide-item>
      </v-slide-group>
    </v-sheet>
  </div>
</template>

<script>
// import moviePickitem from "@/components/moviePickitem";
import _ from "lodash";
export default {
  name: "MoviePickView",
  methods: {
    resetMoods() {
      if (!this.isLoggedIn) {
        alert("ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”");
        this.$router.push("login");
        return;
      }
      for (let id in this.clicked) {
        this.clicked[id] = false;
      }
      for (let id in this.moodsCount) {
        this.moodsCount[id] = 0;
      }
    },
    save() {
      this.clickedList = [];
      this.pickedMoods = [];
      this.recommendMovie = [];
      this.recommendMovieId = [];
      for (let id in this.clicked) {
        let picked = this.clicked[id];
        if (picked) {
          this.clickedList.push(id);
        }
      }
      if (this.clickedList.length !== 5) {
        alert("ì§€ê¸ˆ ê¸°ë¶„ì„ 5ê°œ ì„ íƒí•´ì£¼ì„¸ìš©");
        return;
      }
      for (let clickedKey of this.clickedList) {
        for (let id in this.moods) {
          let oneMoodList = this.moods[id];
          if (oneMoodList.includes(clickedKey)) {
            this.pickedMoods.push(id);
          }
        }
      }
      for (let pickedMood of this.pickedMoods) {
        this.moodsCount[pickedMood] += 1;
      }
      for (let id in this.moodsCount) {
        let count = this.moodsCount[id];
        if (count) {
          let i = 0;
          const recommendedMovie = _.cloneDeep(this.classifyMovie[id]);
          while (i < count*2) {
            const randomMovie = _.sample(recommendedMovie);
            if (!this.recommendMovieId.includes(randomMovie.id)) {
              this.recommendMovie.push(randomMovie);
              this.recommendMovieId.push(randomMovie.id);
              i += 1;
            }
          }
        }
      }
      this.getGenre();
      this.dialog = false;
    },
    getGenre() {
      // const movieListLen= movies.length
      const genresDic = this.genres;
      for (let movie of this.recommendMovie) {
        let newGenre = [];
        for (let movieGenre of movie.genre_ids) {
          newGenre.push(genresDic[movieGenre]);
        }
        movie.genre_ids = newGenre;
      }
    },
    isLogin() {
      if (window.localStorage.getItem("jwt")) {
        this.isLoggedIn = true;
      } else {
        this.isLoggedIn = false;
      }
    },
  },
  components: {
    // moviePickitem,
  },
  computed: {
    classifyMovie() {
      return this.$store.state.classifiedMovie;
    },
  },
  data() {
    return {
      isLoggedIn: false,
      dialog: false,
      clickedCount: 0,
      clicked: {
        clicked1: false,
        clicked2: false,
        clicked3: false,
        clicked4: false,
        clicked5: false,
        clicked6: false,
        clicked7: false,
        clicked8: false,
        clicked9: false,
        clicked10: false,
        clicked11: false,
        clicked12: false,
        clicked13: false,
        clicked14: false,
        clicked15: false,
        clicked16: false,
        clicked17: false,
        clicked18: false,
        clicked19: false,
        clicked20: false,
        clicked21: false,
        clicked22: false,
      },
      moods: {
        28: ["clicked1", "clicked2", "clicked3"],
        12: ["clicked4", "clicked5", "clicked6"],
        35: ["clicked7", "clicked8", "clicked9"],
        80: ["clicked10", "clicked11"],
        10751: ["clicked12", "clicked13", "clicked14"],
        14: ["clicked15", "clicked16", "clicked17"],
        10749: ["clicked18", "clicked19", "clicked20"],
        53: ["clicked21", "clicked22"],
      },
      moodsCount: {
        28: 0,
        12: 0,
        35: 0,
        80: 0,
        10751: 0,
        14: 0,
        10749: 0,
        53: 0,
      },
      genres: {
        28: "ì•¡ì…˜",
        12: "ëª¨í—˜",
        16: "ì• ë‹ˆë©”ì´ì…˜",
        35: "ì½”ë¯¸ë””",
        80: "ë²”ì£„",
        99: "ë‹¤íë©˜í„°ë¦¬",
        18: "ë“œë¼ë§ˆ",
        10751: "ê°€ì¡±",
        14: "íŒíƒ€ì§€",
        36: "ì—­ì‚¬",
        27: "ê³µí¬",
        10402: "ìŒì•…",
        9648: "ë¯¸ìŠ¤í„°ë¦¬",
        10749: "ë¡œë§¨ìŠ¤",
        878: "SF",
        10770: "TV ì˜í™”",
        53: "ìŠ¤ë¦´ëŸ¬",
        10752: "ì „ìŸ",
        37: "ì„œë¶€",
      },
      clickedList: [],
      pickedMoods: [],
      recommendMovie: [],
      recommendMovieId: [],
    };
  },
  created() {
    this.isLogin();
  },
};
</script>

<style>
@font-face {
  font-family: "SANJUGotgam";
  src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2112@1.0/SANJUGotgam.woff")
    format("woff");
  font-weight: normal;
  font-style: normal;
}
@font-face {
    font-family: 'ONE-Mobile-POP';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/ONE-Mobile-POP.woff') format('woff');
    font-weight: normal;
    font-style: normal;
}
@font-face {
    font-family: 'Katuri';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_13@1.0/Katuri.woff') format('woff');
    font-weight: normal;
    font-style: normal;
}
.recommendpage {
  background-color: #000000;
  color: white;
}
.recommendmovie {
  background-color: black;
}
.my-font {
  font-family: ONE-Mobile-POP;
}
.my-font2 {
  font-family: SANJUGotgam;
  background-color: black;
}
.my-font3{
  font-family:Katuri;
}
</style>